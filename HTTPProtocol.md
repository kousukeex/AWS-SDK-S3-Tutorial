# 詳細について
S3Clientの詳しいページは<a href="https://docs.aws.amazon.com/aws-sdk-php/v3/api/class-Aws.S3.S3Client.html">こちら(英語)</a>

# S3のデータのやりとり
S3では、HTTPプロトコルを利用してやりとりを行っているため、注意が必要です
関連性のあるものだけを抜粋しています。

# HTTPプロトコルのルール
HTTPプロトコルでは一回の通信で行うようにしています。
一回の送信を行うと一回の返信を行います。
そのため、キャッチボールを行うように通信を行っています。
HTTPプロトコルでは以下のメッセージでやりとりをしています。

- 送信->HTTPリクエスト
- 返信->HTTPレスポンス

# HTTPレスポンス(HTTPResponse)
HTTPリクエストを受け取ったら、それに返信するメッセージがHTTPレスポンスです。
関連するメソッドが"getObject"です。
```
$result = $s3->getObject([
    'Bucket'                     => $bucket, //バケット名
    'Key'                        => $keyname, //オブジェクトキー名(S3ではファイル名)
    'ResponseContentType'        => 'text/plain', //取得するデータ形式
    'ResponseContentLanguage'    => 'en-US',      //言語
    'ResponseContentDisposition' => 'attachment; filename=testing.txt', //変更後のファイル名
    'ResponseCacheControl'       => 'No-cache',   //キャッシュを行うか
    'ResponseExpires'            => gmdate(DATE_RFC2822, time() + 3600),//返信の有効期限
]);
```
よく使うデータ項目(連想配列形式)

| データ項目名 | 意味 |
----|---- 
| $result["Body"] | データの中身 |
| $result["@metadata"]["statusCode"] | ステータスコード |

# HTTPリクエスト(HTTPRequest)
HTTPリクエストは、何らかのアクションを定義したデータです。
要求を送ると、プログラムが何を求めているのかを読み取り、返信を行うことができます
関連するメソッドが"putObject"や"postObject"がありますが、ここではputObjectのみを記載します
```
    $result = $s3->putObject([
        'Bucket' => $bucket,         //バケット名
        'Key'    => $keyname,        //オブジェクトキー名(S3ではファイル名)
        'Body'   => 'Hello, world!', //データ
    ]);
```

よく使うデータ項目(連想配列形式)
送信後のため、注意が必要

| データ項目名 | 意味 |
----|---- 
| $result["@metadata"]["statusCode"] | ステータスコード |
| $result["ObjectURL"] | S3バケットでアップロードしたURL(HTTPS) | 

# 簡単なステータスコード
送信と受信で処理が終了したときのメッセージ、基本的には200が返ってこればいいのだが、
何らかの異常があったときに、200以外のコードが返ってくる可能性がある
どういう意味なのか簡単なものだけど、記載しておきます

- 100 情報 受け取ったときの情報、このまま処理が行われるため関係ない
- 200 成功 リクエストが正常に終わったことを表す
  - 200 正常に成功
  - 201 正常に完了し、新しく作成したリソースのURIが返ってくる
  - 202 リクエストは受理されたが、処理は完了していない。
  - 203 怪しい情報、ローカルやプロキシからの情報
  - 204 内容なし。リクエストを受理したが、返すべきレスポンスエンティティが存在しない場合に返される。
  - 205 内容のリセット。リクエストを受理し、ユーザエージェントの画面をリセットする場合に返される。
  - 206 部分的内容。部分的GETリクエストを受理したときに、返される。
  ^ 207～209は、WebDAVの拡張コードのため、多分関係ない
- 300 リダイレクション 正常に終わったけど、追加で処理する必要がある
- 400 クライアント(リクエストする側)エラー 途中でトラブルがあるときに、メッセージを返す　超重要!
  - 400 リクエストが不正である、リクエストの指定が正常ではないことを表す
  - 401 認証が必要、多分関係ないけど、セキュリティ的に必要なら使用するべき
  - 402 支払いが必要、関係ないね
  - 403 アクセス禁止、これが出たら権限が無いことを表す　S3ではポリシーに原因がある
  - 404 未検出、これが出たらファイルが無いか、指定するものが違うか
  - 405 許可されていないメソッド、HTTPメソッドのお話しで、許可されていないメソッドが使われたことを表す
  - 406 受理できない、リクエストで許可されていないパラメータを使用したときに返す
  - 408 タイムアウト、リクエストが時間内に完了できていなかったことを表す
  - 414 URIがでかすぎィ、念のため記載しておく
- 500 サーバ(リクエストされる側)のエラー、S3ではないけど、EC2ならありえそう
  - 500 サーバ内部エラー、PHPとかが、エラーが発生した
  - 501 未実装、多分関係ない
  - 503 利用不可、何かダウンしている
  - 505 サポートしていないHTTPバージョン、関係ないけど念のため
